<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seva Messenger</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Экран авторизации -->
  <div id="auth-screen" class="screen">
    <div class="auth-container">
      <div class="auth-logo">
        <svg viewBox="0 0 240 240" width="120" height="120">
          <rect width="240" height="240" rx="30" fill="#3390ec"/>
          <path d="M100,60 L160,90 L160,140 C160,180 100,210 60,180 C40,165 40,140 60,130 C75,120 90,140 90,140 L100,150 C100,150 80,155 60,145 C40,130 40,90 80,75 C95,68 100,60 100,60 Z" fill="white"/>
        </svg>
      </div>
      <h1>Seva Messenger</h1>
      
      <div class="auth-tabs">
        <button class="auth-tab active" data-tab="login">Вход</button>
        <button class="auth-tab" data-tab="register">Регистрация</button>
      </div>

      <!-- Форма входа -->
      <form id="login-form" class="auth-form active">
        <div class="form-group">
          <input type="text" id="login-username" placeholder="Имя пользователя" required>
        </div>
        <div class="form-group">
          <input type="password" id="login-password" placeholder="Пароль" required>
        </div>
        <button type="submit" class="btn btn-primary">Войти</button>
        <p class="auth-error" id="login-error"></p>
      </form>

      <!-- Форма регистрации -->
      <form id="register-form" class="auth-form">
        <div class="form-group">
          <input type="text" id="register-username" placeholder="Придумайте имя пользователя" required minlength="3">
        </div>
        <div class="form-group">
          <input type="password" id="register-password" placeholder="Придумайте пароль" required minlength="6">
        </div>
        <div class="form-group">
          <input type="password" id="register-password-confirm" placeholder="Повторите пароль" required>
        </div>
        <button type="submit" class="btn btn-primary">Создать аккаунт</button>
        <p class="auth-error" id="register-error"></p>
      </form>
    </div>
  </div>

  <!-- Основной интерфейс мессенджера -->
  <div id="main-screen" class="screen hidden">
    <!-- Список чатов (левая панель) -->
    <div id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <div class="user-info" id="current-user-info">
          <div class="user-avatar" id="current-user-avatar"></div>
          <span class="user-name" id="current-username"></span>
        </div>
      </div>

      <div class="search-container">
        <input type="text" id="search-chats" placeholder="Поиск">
      </div>

      <button class="new-chat-btn" id="new-chat-btn">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
        Новый чат
      </button>

      <div class="chats-list" id="chats-list">
        <!-- Чаты будут добавлены через JavaScript -->
      </div>
    </div>

    <!-- Область чата (правая панель) -->
    <div id="chat-area" class="chat-area">
      <!-- Пустое состояние -->
      <div id="empty-state" class="empty-state">
        <div class="empty-state-icon">
          <svg viewBox="0 0 240 240" width="200" height="200">
            <rect width="240" height="240" rx="30" fill="#f5f5f5"/>
            <path d="M100,60 L160,90 L160,140 C160,180 100,210 60,180 C40,165 40,140 60,130 C75,120 90,140 90,140 L100,150 C100,150 80,155 60,145 C40,130 40,90 80,75 C95,68 100,60 100,60 Z" fill="#3390ec"/>
          </svg>
        </div>
        <h2>Seva Messenger</h2>
        <p>Выберите чат или начните новый</p>
      </div>

      <!-- Активный чат -->
      <div id="active-chat" class="active-chat hidden">
        <div class="chat-header" id="chat-header">
          <button class="back-btn" id="back-btn">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
          </button>
          <div class="chat-header-info">
            <div class="chat-avatar" id="chat-avatar"></div>
            <div class="chat-header-text">
              <div class="chat-name" id="chat-name"></div>
              <div class="chat-status" id="chat-status"></div>
            </div>
          </div>
          <div class="chat-header-actions">
            <button class="header-btn" id="call-btn" title="Голосовой звонок">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="messages-container" id="messages-container">
          <div class="messages-list" id="messages-list">
            <!-- Сообщения будут добавлены через JavaScript -->
          </div>
          <div class="typing-indicator" id="typing-indicator">
            <span></span><span></span><span></span>
          </div>
        </div>

        <div class="input-area">
          <div class="input-wrapper">
            <button class="attach-btn" id="attach-btn" title="Прикрепить файл">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/>
              </svg>
            </button>
            <textarea id="message-input" placeholder="Сообщение..." rows="1"></textarea>
            <button class="send-btn" id="send-btn" title="Отправить">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Модальное окно создания чата -->
  <div id="new-chat-modal" class="modal hidden">
    <div class="modal-backdrop" id="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Создать новый чат</h3>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <div class="modal-search">
        <input type="text" id="user-search" placeholder="Поиск пользователей...">
      </div>
      <div class="users-list" id="users-list">
        <!-- Пользователи будут добавлены через JavaScript -->
      </div>
    </div>
  </div>

  <!-- Модальное окно входящего звонка -->
  <div id="call-modal" class="call-modal hidden">
    <div class="call-modal-backdrop"></div>
    <div class="call-modal-content">
      <div class="call-avatar" id="call-avatar"></div>
      <div class="call-name" id="call-name">Имя</div>
      <div class="call-status" id="call-status">Входящий звонок...</div>
      <div class="call-actions">
        <button class="call-btn call-accept" id="call-accept">
          <svg viewBox="0 0 24 24" width="32" height="32">
            <path fill="currentColor" d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/>
          </svg>
        </button>
        <button class="call-btn call-decline" id="call-decline">
          <svg viewBox="0 0 24 24" width="32" height="32">
            <path fill="currentColor" d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Панель активного звонка -->
  <div id="active-call-panel" class="active-call-panel hidden">
    <div class="active-call-info">
      <div class="active-call-avatar" id="active-call-avatar"></div>
      <div class="active-call-details">
        <div class="active-call-name" id="active-call-name">Имя</div>
        <div class="active-call-timer" id="active-call-timer">00:00</div>
      </div>
    </div>
    <button class="hangup-btn" id="hangup-btn">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <path fill="currentColor" d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/>
      </svg>
    </button>
  </div>

  <!-- Скрытые аудио элементы -->
  <audio id="ringtone" src="zvonky.mp3" loop></audio>
  <audio id="remote-audio" autoplay></audio>

  <script src="/socket.io/socket.io.js"></script>
  <script src="auth.js"></script>
  <script src="app.js"></script>
</body>
</html>
